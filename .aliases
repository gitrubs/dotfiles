# Easier navigation
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."

# List alias
alias l="ls -l"
alias la="ls -la"
alias lsd='ls -l | grep "^d"'

# Merge PDF files
# Usage: `pdfmerge -o output.pdf input{1,2,3}.pdf`
alias pdfmerge='/System/Library/Automator/Combine\ PDF\ Pages.action/Contents/Resources/join.py'

# Audio and video files
# Usage: `compress_video input.mp4 output.mp4`
function compress_video() {
  if [[ $# -ne 1 ]]; then
    echo "Usage: compress_video <input_file>"
    return 1
  fi
  ffmpeg -i $1 -c:v libx264 -crf 28 -c:a aac -b:a 128k $1'_reduced.mp4'
}
alias compress_video=compress_video

# Usage: `shrink_video input.mp4 480` will compress the video to 480p
function shrink_video() {
  if [[ $# -ne 2 ]]; then
    echo "Usage: shrink_video <input_file> <target_height>"
    return 1
  fi
  ffmpeg -i $1 -vf scale=-1:$2 $1'_'$2'.mp4'
}
alias shrink_video=shrink_video

# Usage: `video_to_480p input.mp4` will compress the video to 480p
function video_to_480p() {
  if [[ $# -ne 1 ]]; then
    echo "Usage: video_to_480p <input_file>"
    return 1
  fi
  ffmpeg -i $1 -vf scale=854:480 -c:v libx264 -crf 28 -c:a aac -b:a 128k '[480p] '$1
}
alias video_to_480p=video_to_480p

# Quick home
function home() {
  cd ~/$@
}

# Pretty json
alias prettyjson="python -m json.tool | pygmentize -l json"

# Add space in the Dock
alias add-dock-space="defaults write com.apple.dock persistent-apps -array-add '{tile-data={}; tile-type=\"spacer-tile\";}' | killall Dock"

# Sha1 generation
function sha1() {
  echo -n $@ | openssl sha1
}
alias sha1=sha1

# Random number
# Usage: `rand` will produce a random number between 1 adn 6
# Usage: `rand 100` will produce a random number between 1 and 100
function rand() {
  if [[ -n "$@" ]]; then
    echo $[RANDOM%$@+1];
  else
    echo $[RANDOM%6+1];
  fi;
}
alias rand=rand

# Get a password in keychain
# Usage `getpassword {ssid}`
function getpassword() {
  if [[ -n "$@" ]]; then
    security find-generic-password -ga $@ | grep "password:"
  else

    airport="/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport"
    ssid="`$airport -I | awk '/ SSID/ {print substr($0, index($0, $2))}'`"

    if [[ "$ssid" != "" ]]; then
      getpassword $ssid
      return
    fi;

    echo "ERROR: You are not connected to any wifi so you should pass an ssid to search for: getpassword {ssid}"
  fi;
}
alias getpassword=getpassword

# Quick move
alias home=home

# Reload bashrc
alias reload=". ~/.zshrc"

# Move to development folder
alias dev="cd ~/dev"

# Apps
alias xcode="open -a '/Developer/Applications/Xcode.app'"
alias filemerge="open -a '/Developer/Applications/Utilities/FileMerge.app'"
alias safari="open -a safari"
alias chrome="open -a google\ chrome"
alias simulator='open /Applications/Xcode-beta.app/Contents/Developer/Applications/iOS\ Simulator.app'

# Github
alias gh="open https://github.com/gitrubs"
alias ggup="git checkout main && git fetch origin main && git pull origin main && git checkout -"

# github repo
# Open the git repository in the browser if git remote origin is defined
function gh_repo() {
  if [[ $(git remote -v 2> /dev/null) ]]; then
    git remote -v | grep origin | awk '{ print $2 }' | head -1 | xargs open
  else
    echo "Can't find 'origin' repository in this path"
  fi
}
alias ghrepo=gh_repo

# bitbucket repo
# Open the git repository in the browser if git remote origin is defined
function bb_repo() {
  if [[ $(git remote -v 2> /dev/null) ]]; then
    git remote -v | grep origin | awk '{ repo=substr($2, 1, length($2)-length(".git")); print repo"/src" }' | head -1 | xargs open
  else
    echo "Can't find 'origin' repository in this path"
  fi
}
alias bbrepo=bb_repo

# github branch
# Open the git branch in the browser
function gh_branch() {
  branch="`git rev-parse --abbrev-ref HEAD`"
  repo="`git remote -v | grep origin | awk '{ print $2 }' | head -1 | sed 's/\.git//'`"

  open "$repo/tree/$branch"
}
alias ghbranch=gh_branch

# IP addresses
alias ip="dig +short myip.opendns.com @resolver1.opendns.com"
alias ips="ifconfig -a | perl -nle'/(\d+\.\d+\.\d+\.\d+)/ && print $1'"

# Qli
alias file_from_secret=file_from_secret

function file_from_secret() {
  if [[ $# -ne 2 ]]; then
    echo "Usage: file_from_secret <secret_path> <file_name>"
    return 1
  fi
  qli kv get $1 | sed 's/^value: //' | openssl enc -base64 -d -A > $2
}
